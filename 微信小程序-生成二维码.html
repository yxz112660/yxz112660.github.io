<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222"/>
<meta name="baidu_union_verify" content="90f073406ec1c09a0613604541005cae">
<meta name="google-site-verification" content="D-vggrpBwX17Wy_nCc6gbNzPKk8fXDWxjZycAwvAIWQ" />

<!-- adsense AMP --> 
<script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>

<!-- adsense -->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-9037517277428547",
          enable_page_level_ads: true
     });
</script>


<!-- google fen xi -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-132423284-1', 'auto');
      ga('send', 'pageview');
    </script>
  



<!-- hong xin -->
<!--
<script type="text/javascript" src="/js/src/love.js"></script>
-->

























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2"/>

<link rel="stylesheet" href="/css/main.css?v=6.7.0"/>


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.7.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.7.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.7.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.7.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '6.7.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: 'TIZNETFNU4',
      apiKey: '7d85391b8c05c57d4007663e15a8fc15',
      indexName: 'blog',
      hits: {"per_page":10},
      labels: {"input_placeholder":"搜索文章","hits_empty":"我们没有找到任何搜索结果: ${query}","hits_stats":"在${time} ms中找到“ ${hits}结果”"}
    }
  };
</script>


  




  <meta name="description" content="页面.wxml&amp;lt;view class=&quot;container&quot;&amp;gt;  &amp;lt;!-- 生成二维码 --&amp;gt;  &amp;lt;view class=&quot;input-row&quot;&amp;gt;      &amp;lt;label&amp;gt;内容&amp;lt;/label&amp;gt;      &amp;lt;input value=&apos;&amp;#123;&amp;#123;qrcStr&amp;#125;&amp;#125;&apos; class=&quot;qrcInput&quot; bi">
<meta name="keywords" content="小程序">
<meta property="og:type" content="article">
<meta property="og:title" content="微信小程序-生成二维码">
<meta property="og:url" content="http://www.yangxiaozong.com/微信小程序-生成二维码.html">
<meta property="og:site_name" content="YXZ的博客">
<meta property="og:description" content="页面.wxml&amp;lt;view class=&quot;container&quot;&amp;gt;  &amp;lt;!-- 生成二维码 --&amp;gt;  &amp;lt;view class=&quot;input-row&quot;&amp;gt;      &amp;lt;label&amp;gt;内容&amp;lt;/label&amp;gt;      &amp;lt;input value=&apos;&amp;#123;&amp;#123;qrcStr&amp;#125;&amp;#125;&apos; class=&quot;qrcInput&quot; bi">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2019-01-18T07:50:25.738Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="微信小程序-生成二维码">
<meta name="twitter:description" content="页面.wxml&amp;lt;view class=&quot;container&quot;&amp;gt;  &amp;lt;!-- 生成二维码 --&amp;gt;  &amp;lt;view class=&quot;input-row&quot;&amp;gt;      &amp;lt;label&amp;gt;内容&amp;lt;/label&amp;gt;      &amp;lt;input value=&apos;&amp;#123;&amp;#123;qrcStr&amp;#125;&amp;#125;&apos; class=&quot;qrcInput&quot; bi">



  <link rel="alternate" href="/atom.xml" title="YXZ的博客" type="application/atom+xml"/>




  <link rel="canonical" href="http://www.yangxiaozong.com/微信小程序-生成二维码.html"/>



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>微信小程序-生成二维码 | YXZ的博客</title>
  




  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-132423284-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-132423284-1');
  </script>









  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">YXZ的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">人生入戏，全凭演技</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-主页">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br/>主页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-标签">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br/>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-分类">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br/>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-归档">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br/>归档</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-站点地图">

    
    
    
      
    

    

    <a href="/sitemap.xml" rel="section"><i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br/>站点地图</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br/>搜索</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup search-popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.yangxiaozong.com/微信小程序-生成二维码.html"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="YXZ"/>
      <meta itemprop="description" content=""/>
      <meta itemprop="image" content="/images/head.jpg"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="YXZ的博客"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">微信小程序-生成二维码

              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-06-06 08:08:08" itemprop="dateCreated datePublished" datetime="2018-06-06T08:08:08+08:00">2018-06-06</time>
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/小程序/" itemprop="url" rel="index"><span itemprop="name">小程序</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/微信小程序-生成二维码.html#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">评论数：</span> <span class="post-comments-count valine-comment-count" data-xid="/微信小程序-生成二维码.html" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
            <span id="/微信小程序-生成二维码.html" class="leancloud_visitors" data-flag-title="微信小程序-生成二维码">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="页面-wxml"><a href="#页面-wxml" class="headerlink" title="页面.wxml"></a>页面.wxml</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;view <span class="class"><span class="keyword">class</span></span>=<span class="string">"container"</span>&gt;</span><br><span class="line">  &lt;!-- 生成二维码 --&gt;</span><br><span class="line">  &lt;view <span class="class"><span class="keyword">class</span></span>=<span class="string">"input-row"</span>&gt;</span><br><span class="line">      &lt;label&gt;内容&lt;<span class="regexp">/label&gt;</span></span><br><span class="line"><span class="regexp">      &lt;input value='&#123;&#123;qrcStr&#125;&#125;' class="qrcInput" bindblur="onQrcStrBlur" type="text" maxlength="255" </span></span><br><span class="line"><span class="regexp">                placeholder="&#123;&#123;qrcPhld&#125;&#125;"/</span>&gt;</span><br><span class="line">  &lt;<span class="regexp">/view&gt;</span></span><br><span class="line"><span class="regexp">  &lt;button class="genQrcBtn" type="primary" bindtap="onGenQrc"&gt;生成二维码&lt;/</span>button&gt;</span><br><span class="line"></span><br><span class="line">  &lt;view <span class="class"><span class="keyword">class</span></span>=<span class="string">"img-box"</span>&gt;</span><br><span class="line">      &lt;canvas bindtap=<span class="string">"onPreviewQrc"</span> hidden=<span class="string">"&#123;&#123;canvasHidden&#125;&#125;"</span> </span><br><span class="line">                style=<span class="string">"width: 686rpx;height: 686rpx;background:#f1f1f1;"</span> canvas-id=<span class="string">"qrcCanvas"</span>/&gt;</span><br><span class="line">  &lt;<span class="regexp">/view&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>view&gt; </span><br><span class="line">&lt;view hidden=<span class="string">"&#123;&#123;maskHidden&#125;&#125;"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"mask"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line">&lt;view <span class="class"><span class="keyword">class</span></span>=<span class="string">"canvas-box"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h3 id="样式-wxss"><a href="#样式-wxss" class="headerlink" title="样式.wxss"></a>样式.wxss</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;  </span><br><span class="line">  <span class="attribute">padding-top</span>: <span class="number">0</span>rpx;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="selector-class">.img-box</span> &#123;  </span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">32</span>rpx;  </span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#fff</span>;  </span><br><span class="line">  <span class="attribute">border-bottom</span>: <span class="number">1</span>rpx solid <span class="number">#e5e5e5</span>;  </span><br><span class="line">  <span class="attribute">position</span>: relative;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="selector-class">.img-box</span> <span class="selector-tag">image</span> &#123;  </span><br><span class="line">  <span class="attribute">width</span>: <span class="number">686</span>rpx;  </span><br><span class="line">  <span class="attribute">height</span>: <span class="number">686</span>rpx;  </span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#f9f9f9</span>;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="selector-class">.input-row</span>&#123;  </span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">30</span>rpx auto;  </span><br><span class="line">    <span class="attribute">display</span>: flex;  </span><br><span class="line">    <span class="attribute">align-items</span>: center;  </span><br><span class="line">    <span class="attribute">height</span>: <span class="number">88</span>rpx;  </span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">32</span>rpx;   </span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#fff</span>;  </span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">34</span>rpx;  </span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#000</span>;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="selector-class">.input-row</span> <span class="selector-tag">input</span> &#123;  </span><br><span class="line">  <span class="attribute">margin-left</span>: <span class="number">100</span>rpx;  </span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">1</span>;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="selector-class">.qrcInput</span> &#123;  </span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1</span>rpx solid <span class="number">#e5e5e5</span>;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="selector-class">.genQrcBtn</span> &#123;  </span><br><span class="line">  <span class="attribute">width</span>:<span class="number">686</span>rpx;  </span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">60</span>rpx auto;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="selector-class">.mask</span> &#123;  </span><br><span class="line">  <span class="attribute">position</span>: fixed;  </span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;  </span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;  </span><br><span class="line">  <span class="attribute">z-index</span>: <span class="number">3</span>;   </span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;  </span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;  </span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="逻辑-js"><a href="#逻辑-js" class="headerlink" title="逻辑.js"></a>逻辑.js</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> QR = <span class="built_in">require</span>(<span class="string">"../../utils/qrcode.js"</span>);</span><br><span class="line">Page(&#123;  </span><br><span class="line">  data: &#123;  </span><br><span class="line">    qrcStr: <span class="string">''</span>,  </span><br><span class="line">    qrcPhld: <span class="string">'维康云u=1001'</span>,  </span><br><span class="line">    maskHidden:<span class="literal">true</span>,  </span><br><span class="line">    imagePath:<span class="string">''</span>,  </span><br><span class="line">  &#125;,  </span><br><span class="line">  canvasId: <span class="string">"qrcCanvas"</span>,  </span><br><span class="line">  onReady: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;  </span><br><span class="line">    <span class="keyword">this</span>.size = <span class="keyword">this</span>.setCanvasSize();<span class="comment">//动态设置画布大小  </span></span><br><span class="line">    <span class="keyword">this</span>.createQrCode(<span class="keyword">this</span>.data.qrcPhld, <span class="keyword">this</span>.canvasId, <span class="keyword">this</span>.size.w, <span class="keyword">this</span>.size.h);  </span><br><span class="line">  &#125;,  </span><br><span class="line">  <span class="comment">//适配不同屏幕大小的canvas  </span></span><br><span class="line">  setCanvasSize:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;  </span><br><span class="line">    <span class="keyword">var</span> size=&#123;&#125;;  </span><br><span class="line">    <span class="keyword">try</span> &#123;  </span><br><span class="line">        <span class="keyword">var</span> res = wx.getSystemInfoSync();  </span><br><span class="line">        <span class="keyword">var</span> scale = <span class="number">750</span>/<span class="number">686</span>;<span class="comment">//不同屏幕下canvas的适配比例；设计稿是750宽  </span></span><br><span class="line">        <span class="keyword">var</span> width = res.windowWidth/scale;  </span><br><span class="line">        <span class="keyword">var</span> height = width;<span class="comment">//canvas画布为正方形  </span></span><br><span class="line">        size.w = width;  </span><br><span class="line">        size.h = height;  </span><br><span class="line">      &#125; <span class="keyword">catch</span> (e) &#123;  </span><br><span class="line">        <span class="comment">// Do something when catch error  </span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"获取设备信息失败"</span>+e);  </span><br><span class="line">      &#125;   </span><br><span class="line">    <span class="keyword">return</span> size;  </span><br><span class="line">  &#125; ,  </span><br><span class="line">  createQrCode:<span class="function"><span class="keyword">function</span>(<span class="params">str,canvasId,cavW,cavH</span>)</span>&#123;  </span><br><span class="line">    <span class="comment">//调用插件中的draw方法，绘制二维码图片  </span></span><br><span class="line">    QR.api.draw(str,canvasId,cavW,cavH);  </span><br><span class="line">  &#125;,  </span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>
<h3 id="需要的插件-qrcode-js"><a href="#需要的插件-qrcode-js" class="headerlink" title="需要的插件-qrcode.js"></a>需要的插件-qrcode.js</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">!(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// alignment pattern</span></span><br><span class="line">  <span class="keyword">var</span> adelta = [</span><br><span class="line">    <span class="number">0</span>, <span class="number">11</span>, <span class="number">15</span>, <span class="number">19</span>, <span class="number">23</span>, <span class="number">27</span>, <span class="number">31</span>,</span><br><span class="line">    <span class="number">16</span>, <span class="number">18</span>, <span class="number">20</span>, <span class="number">22</span>, <span class="number">24</span>, <span class="number">26</span>, <span class="number">28</span>, <span class="number">20</span>, <span class="number">22</span>, <span class="number">24</span>, <span class="number">24</span>, <span class="number">26</span>, <span class="number">28</span>, <span class="number">28</span>, <span class="number">22</span>, <span class="number">24</span>, <span class="number">24</span>,</span><br><span class="line">    <span class="number">26</span>, <span class="number">26</span>, <span class="number">28</span>, <span class="number">28</span>, <span class="number">24</span>, <span class="number">24</span>, <span class="number">26</span>, <span class="number">26</span>, <span class="number">26</span>, <span class="number">28</span>, <span class="number">28</span>, <span class="number">24</span>, <span class="number">26</span>, <span class="number">26</span>, <span class="number">26</span>, <span class="number">28</span>, <span class="number">28</span></span><br><span class="line">  ];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// version block</span></span><br><span class="line">  <span class="keyword">var</span> vpat = [</span><br><span class="line">    <span class="number">0xc94</span>, <span class="number">0x5bc</span>, <span class="number">0xa99</span>, <span class="number">0x4d3</span>, <span class="number">0xbf6</span>, <span class="number">0x762</span>, <span class="number">0x847</span>, <span class="number">0x60d</span>,</span><br><span class="line">    <span class="number">0x928</span>, <span class="number">0xb78</span>, <span class="number">0x45d</span>, <span class="number">0xa17</span>, <span class="number">0x532</span>, <span class="number">0x9a6</span>, <span class="number">0x683</span>, <span class="number">0x8c9</span>,</span><br><span class="line">    <span class="number">0x7ec</span>, <span class="number">0xec4</span>, <span class="number">0x1e1</span>, <span class="number">0xfab</span>, <span class="number">0x08e</span>, <span class="number">0xc1a</span>, <span class="number">0x33f</span>, <span class="number">0xd75</span>,</span><br><span class="line">    <span class="number">0x250</span>, <span class="number">0x9d5</span>, <span class="number">0x6f0</span>, <span class="number">0x8ba</span>, <span class="number">0x79f</span>, <span class="number">0xb0b</span>, <span class="number">0x42e</span>, <span class="number">0xa64</span>,</span><br><span class="line">    <span class="number">0x541</span>, <span class="number">0xc69</span></span><br><span class="line">  ];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// final format bits with mask: level &lt;&lt; 3 | mask</span></span><br><span class="line">  <span class="keyword">var</span> fmtword = [</span><br><span class="line">    <span class="number">0x77c4</span>, <span class="number">0x72f3</span>, <span class="number">0x7daa</span>, <span class="number">0x789d</span>, <span class="number">0x662f</span>, <span class="number">0x6318</span>, <span class="number">0x6c41</span>, <span class="number">0x6976</span>,    <span class="comment">//L</span></span><br><span class="line">    <span class="number">0x5412</span>, <span class="number">0x5125</span>, <span class="number">0x5e7c</span>, <span class="number">0x5b4b</span>, <span class="number">0x45f9</span>, <span class="number">0x40ce</span>, <span class="number">0x4f97</span>, <span class="number">0x4aa0</span>,    <span class="comment">//M</span></span><br><span class="line">    <span class="number">0x355f</span>, <span class="number">0x3068</span>, <span class="number">0x3f31</span>, <span class="number">0x3a06</span>, <span class="number">0x24b4</span>, <span class="number">0x2183</span>, <span class="number">0x2eda</span>, <span class="number">0x2bed</span>,    <span class="comment">//Q</span></span><br><span class="line">    <span class="number">0x1689</span>, <span class="number">0x13be</span>, <span class="number">0x1ce7</span>, <span class="number">0x19d0</span>, <span class="number">0x0762</span>, <span class="number">0x0255</span>, <span class="number">0x0d0c</span>, <span class="number">0x083b</span>    <span class="comment">//H</span></span><br><span class="line">  ];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 4 per version: number of blocks 1,2; data width; ecc width</span></span><br><span class="line">  <span class="keyword">var</span> eccblocks = [</span><br><span class="line">    <span class="number">1</span>, <span class="number">0</span>, <span class="number">19</span>, <span class="number">7</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">16</span>, <span class="number">10</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">13</span>, <span class="number">13</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">9</span>, <span class="number">17</span>,</span><br><span class="line">    <span class="number">1</span>, <span class="number">0</span>, <span class="number">34</span>, <span class="number">10</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">28</span>, <span class="number">16</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">22</span>, <span class="number">22</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">16</span>, <span class="number">28</span>,</span><br><span class="line">    <span class="number">1</span>, <span class="number">0</span>, <span class="number">55</span>, <span class="number">15</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">44</span>, <span class="number">26</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">13</span>, <span class="number">22</span>,</span><br><span class="line">    <span class="number">1</span>, <span class="number">0</span>, <span class="number">80</span>, <span class="number">20</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">32</span>, <span class="number">18</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">24</span>, <span class="number">26</span>, <span class="number">4</span>, <span class="number">0</span>, <span class="number">9</span>, <span class="number">16</span>,</span><br><span class="line">    <span class="number">1</span>, <span class="number">0</span>, <span class="number">108</span>, <span class="number">26</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">43</span>, <span class="number">24</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">15</span>, <span class="number">18</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">11</span>, <span class="number">22</span>,</span><br><span class="line">    <span class="number">2</span>, <span class="number">0</span>, <span class="number">68</span>, <span class="number">18</span>, <span class="number">4</span>, <span class="number">0</span>, <span class="number">27</span>, <span class="number">16</span>, <span class="number">4</span>, <span class="number">0</span>, <span class="number">19</span>, <span class="number">24</span>, <span class="number">4</span>, <span class="number">0</span>, <span class="number">15</span>, <span class="number">28</span>,</span><br><span class="line">    <span class="number">2</span>, <span class="number">0</span>, <span class="number">78</span>, <span class="number">20</span>, <span class="number">4</span>, <span class="number">0</span>, <span class="number">31</span>, <span class="number">18</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">14</span>, <span class="number">18</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">13</span>, <span class="number">26</span>,</span><br><span class="line">    <span class="number">2</span>, <span class="number">0</span>, <span class="number">97</span>, <span class="number">24</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">38</span>, <span class="number">22</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">18</span>, <span class="number">22</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">14</span>, <span class="number">26</span>,</span><br><span class="line">    <span class="number">2</span>, <span class="number">0</span>, <span class="number">116</span>, <span class="number">30</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">36</span>, <span class="number">22</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">16</span>, <span class="number">20</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">12</span>, <span class="number">24</span>,</span><br><span class="line">    <span class="number">2</span>, <span class="number">2</span>, <span class="number">68</span>, <span class="number">18</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">43</span>, <span class="number">26</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">19</span>, <span class="number">24</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">15</span>, <span class="number">28</span>,</span><br><span class="line">    <span class="number">4</span>, <span class="number">0</span>, <span class="number">81</span>, <span class="number">20</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">50</span>, <span class="number">30</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">22</span>, <span class="number">28</span>, <span class="number">3</span>, <span class="number">8</span>, <span class="number">12</span>, <span class="number">24</span>,</span><br><span class="line">    <span class="number">2</span>, <span class="number">2</span>, <span class="number">92</span>, <span class="number">24</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">36</span>, <span class="number">22</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">20</span>, <span class="number">26</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">14</span>, <span class="number">28</span>,</span><br><span class="line">    <span class="number">4</span>, <span class="number">0</span>, <span class="number">107</span>, <span class="number">26</span>, <span class="number">8</span>, <span class="number">1</span>, <span class="number">37</span>, <span class="number">22</span>, <span class="number">8</span>, <span class="number">4</span>, <span class="number">20</span>, <span class="number">24</span>, <span class="number">12</span>, <span class="number">4</span>, <span class="number">11</span>, <span class="number">22</span>,</span><br><span class="line">    <span class="number">3</span>, <span class="number">1</span>, <span class="number">115</span>, <span class="number">30</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">40</span>, <span class="number">24</span>, <span class="number">11</span>, <span class="number">5</span>, <span class="number">16</span>, <span class="number">20</span>, <span class="number">11</span>, <span class="number">5</span>, <span class="number">12</span>, <span class="number">24</span>,</span><br><span class="line">    <span class="number">5</span>, <span class="number">1</span>, <span class="number">87</span>, <span class="number">22</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">41</span>, <span class="number">24</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">24</span>, <span class="number">30</span>, <span class="number">11</span>, <span class="number">7</span>, <span class="number">12</span>, <span class="number">24</span>,</span><br><span class="line">    <span class="number">5</span>, <span class="number">1</span>, <span class="number">98</span>, <span class="number">24</span>, <span class="number">7</span>, <span class="number">3</span>, <span class="number">45</span>, <span class="number">28</span>, <span class="number">15</span>, <span class="number">2</span>, <span class="number">19</span>, <span class="number">24</span>, <span class="number">3</span>, <span class="number">13</span>, <span class="number">15</span>, <span class="number">30</span>,</span><br><span class="line">    <span class="number">1</span>, <span class="number">5</span>, <span class="number">107</span>, <span class="number">28</span>, <span class="number">10</span>, <span class="number">1</span>, <span class="number">46</span>, <span class="number">28</span>, <span class="number">1</span>, <span class="number">15</span>, <span class="number">22</span>, <span class="number">28</span>, <span class="number">2</span>, <span class="number">17</span>, <span class="number">14</span>, <span class="number">28</span>,</span><br><span class="line">    <span class="number">5</span>, <span class="number">1</span>, <span class="number">120</span>, <span class="number">30</span>, <span class="number">9</span>, <span class="number">4</span>, <span class="number">43</span>, <span class="number">26</span>, <span class="number">17</span>, <span class="number">1</span>, <span class="number">22</span>, <span class="number">28</span>, <span class="number">2</span>, <span class="number">19</span>, <span class="number">14</span>, <span class="number">28</span>,</span><br><span class="line">    <span class="number">3</span>, <span class="number">4</span>, <span class="number">113</span>, <span class="number">28</span>, <span class="number">3</span>, <span class="number">11</span>, <span class="number">44</span>, <span class="number">26</span>, <span class="number">17</span>, <span class="number">4</span>, <span class="number">21</span>, <span class="number">26</span>, <span class="number">9</span>, <span class="number">16</span>, <span class="number">13</span>, <span class="number">26</span>,</span><br><span class="line">    <span class="number">3</span>, <span class="number">5</span>, <span class="number">107</span>, <span class="number">28</span>, <span class="number">3</span>, <span class="number">13</span>, <span class="number">41</span>, <span class="number">26</span>, <span class="number">15</span>, <span class="number">5</span>, <span class="number">24</span>, <span class="number">30</span>, <span class="number">15</span>, <span class="number">10</span>, <span class="number">15</span>, <span class="number">28</span>,</span><br><span class="line">    <span class="number">4</span>, <span class="number">4</span>, <span class="number">116</span>, <span class="number">28</span>, <span class="number">17</span>, <span class="number">0</span>, <span class="number">42</span>, <span class="number">26</span>, <span class="number">17</span>, <span class="number">6</span>, <span class="number">22</span>, <span class="number">28</span>, <span class="number">19</span>, <span class="number">6</span>, <span class="number">16</span>, <span class="number">30</span>,</span><br><span class="line">    <span class="number">2</span>, <span class="number">7</span>, <span class="number">111</span>, <span class="number">28</span>, <span class="number">17</span>, <span class="number">0</span>, <span class="number">46</span>, <span class="number">28</span>, <span class="number">7</span>, <span class="number">16</span>, <span class="number">24</span>, <span class="number">30</span>, <span class="number">34</span>, <span class="number">0</span>, <span class="number">13</span>, <span class="number">24</span>,</span><br><span class="line">    <span class="number">4</span>, <span class="number">5</span>, <span class="number">121</span>, <span class="number">30</span>, <span class="number">4</span>, <span class="number">14</span>, <span class="number">47</span>, <span class="number">28</span>, <span class="number">11</span>, <span class="number">14</span>, <span class="number">24</span>, <span class="number">30</span>, <span class="number">16</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">30</span>,</span><br><span class="line">    <span class="number">6</span>, <span class="number">4</span>, <span class="number">117</span>, <span class="number">30</span>, <span class="number">6</span>, <span class="number">14</span>, <span class="number">45</span>, <span class="number">28</span>, <span class="number">11</span>, <span class="number">16</span>, <span class="number">24</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">2</span>, <span class="number">16</span>, <span class="number">30</span>,</span><br><span class="line">    <span class="number">8</span>, <span class="number">4</span>, <span class="number">106</span>, <span class="number">26</span>, <span class="number">8</span>, <span class="number">13</span>, <span class="number">47</span>, <span class="number">28</span>, <span class="number">7</span>, <span class="number">22</span>, <span class="number">24</span>, <span class="number">30</span>, <span class="number">22</span>, <span class="number">13</span>, <span class="number">15</span>, <span class="number">30</span>,</span><br><span class="line">    <span class="number">10</span>, <span class="number">2</span>, <span class="number">114</span>, <span class="number">28</span>, <span class="number">19</span>, <span class="number">4</span>, <span class="number">46</span>, <span class="number">28</span>, <span class="number">28</span>, <span class="number">6</span>, <span class="number">22</span>, <span class="number">28</span>, <span class="number">33</span>, <span class="number">4</span>, <span class="number">16</span>, <span class="number">30</span>,</span><br><span class="line">    <span class="number">8</span>, <span class="number">4</span>, <span class="number">122</span>, <span class="number">30</span>, <span class="number">22</span>, <span class="number">3</span>, <span class="number">45</span>, <span class="number">28</span>, <span class="number">8</span>, <span class="number">26</span>, <span class="number">23</span>, <span class="number">30</span>, <span class="number">12</span>, <span class="number">28</span>, <span class="number">15</span>, <span class="number">30</span>,</span><br><span class="line">    <span class="number">3</span>, <span class="number">10</span>, <span class="number">117</span>, <span class="number">30</span>, <span class="number">3</span>, <span class="number">23</span>, <span class="number">45</span>, <span class="number">28</span>, <span class="number">4</span>, <span class="number">31</span>, <span class="number">24</span>, <span class="number">30</span>, <span class="number">11</span>, <span class="number">31</span>, <span class="number">15</span>, <span class="number">30</span>,</span><br><span class="line">    <span class="number">7</span>, <span class="number">7</span>, <span class="number">116</span>, <span class="number">30</span>, <span class="number">21</span>, <span class="number">7</span>, <span class="number">45</span>, <span class="number">28</span>, <span class="number">1</span>, <span class="number">37</span>, <span class="number">23</span>, <span class="number">30</span>, <span class="number">19</span>, <span class="number">26</span>, <span class="number">15</span>, <span class="number">30</span>,</span><br><span class="line">    <span class="number">5</span>, <span class="number">10</span>, <span class="number">115</span>, <span class="number">30</span>, <span class="number">19</span>, <span class="number">10</span>, <span class="number">47</span>, <span class="number">28</span>, <span class="number">15</span>, <span class="number">25</span>, <span class="number">24</span>, <span class="number">30</span>, <span class="number">23</span>, <span class="number">25</span>, <span class="number">15</span>, <span class="number">30</span>,</span><br><span class="line">    <span class="number">13</span>, <span class="number">3</span>, <span class="number">115</span>, <span class="number">30</span>, <span class="number">2</span>, <span class="number">29</span>, <span class="number">46</span>, <span class="number">28</span>, <span class="number">42</span>, <span class="number">1</span>, <span class="number">24</span>, <span class="number">30</span>, <span class="number">23</span>, <span class="number">28</span>, <span class="number">15</span>, <span class="number">30</span>,</span><br><span class="line">    <span class="number">17</span>, <span class="number">0</span>, <span class="number">115</span>, <span class="number">30</span>, <span class="number">10</span>, <span class="number">23</span>, <span class="number">46</span>, <span class="number">28</span>, <span class="number">10</span>, <span class="number">35</span>, <span class="number">24</span>, <span class="number">30</span>, <span class="number">19</span>, <span class="number">35</span>, <span class="number">15</span>, <span class="number">30</span>,</span><br><span class="line">    <span class="number">17</span>, <span class="number">1</span>, <span class="number">115</span>, <span class="number">30</span>, <span class="number">14</span>, <span class="number">21</span>, <span class="number">46</span>, <span class="number">28</span>, <span class="number">29</span>, <span class="number">19</span>, <span class="number">24</span>, <span class="number">30</span>, <span class="number">11</span>, <span class="number">46</span>, <span class="number">15</span>, <span class="number">30</span>,</span><br><span class="line">    <span class="number">13</span>, <span class="number">6</span>, <span class="number">115</span>, <span class="number">30</span>, <span class="number">14</span>, <span class="number">23</span>, <span class="number">46</span>, <span class="number">28</span>, <span class="number">44</span>, <span class="number">7</span>, <span class="number">24</span>, <span class="number">30</span>, <span class="number">59</span>, <span class="number">1</span>, <span class="number">16</span>, <span class="number">30</span>,</span><br><span class="line">    <span class="number">12</span>, <span class="number">7</span>, <span class="number">121</span>, <span class="number">30</span>, <span class="number">12</span>, <span class="number">26</span>, <span class="number">47</span>, <span class="number">28</span>, <span class="number">39</span>, <span class="number">14</span>, <span class="number">24</span>, <span class="number">30</span>, <span class="number">22</span>, <span class="number">41</span>, <span class="number">15</span>, <span class="number">30</span>,</span><br><span class="line">    <span class="number">6</span>, <span class="number">14</span>, <span class="number">121</span>, <span class="number">30</span>, <span class="number">6</span>, <span class="number">34</span>, <span class="number">47</span>, <span class="number">28</span>, <span class="number">46</span>, <span class="number">10</span>, <span class="number">24</span>, <span class="number">30</span>, <span class="number">2</span>, <span class="number">64</span>, <span class="number">15</span>, <span class="number">30</span>,</span><br><span class="line">    <span class="number">17</span>, <span class="number">4</span>, <span class="number">122</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">14</span>, <span class="number">46</span>, <span class="number">28</span>, <span class="number">49</span>, <span class="number">10</span>, <span class="number">24</span>, <span class="number">30</span>, <span class="number">24</span>, <span class="number">46</span>, <span class="number">15</span>, <span class="number">30</span>,</span><br><span class="line">    <span class="number">4</span>, <span class="number">18</span>, <span class="number">122</span>, <span class="number">30</span>, <span class="number">13</span>, <span class="number">32</span>, <span class="number">46</span>, <span class="number">28</span>, <span class="number">48</span>, <span class="number">14</span>, <span class="number">24</span>, <span class="number">30</span>, <span class="number">42</span>, <span class="number">32</span>, <span class="number">15</span>, <span class="number">30</span>,</span><br><span class="line">    <span class="number">20</span>, <span class="number">4</span>, <span class="number">117</span>, <span class="number">30</span>, <span class="number">40</span>, <span class="number">7</span>, <span class="number">47</span>, <span class="number">28</span>, <span class="number">43</span>, <span class="number">22</span>, <span class="number">24</span>, <span class="number">30</span>, <span class="number">10</span>, <span class="number">67</span>, <span class="number">15</span>, <span class="number">30</span>,</span><br><span class="line">    <span class="number">19</span>, <span class="number">6</span>, <span class="number">118</span>, <span class="number">30</span>, <span class="number">18</span>, <span class="number">31</span>, <span class="number">47</span>, <span class="number">28</span>, <span class="number">34</span>, <span class="number">34</span>, <span class="number">24</span>, <span class="number">30</span>, <span class="number">20</span>, <span class="number">61</span>, <span class="number">15</span>, <span class="number">30</span></span><br><span class="line">  ];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Galois field log table</span></span><br><span class="line">  <span class="keyword">var</span> glog = [</span><br><span class="line">    <span class="number">0xff</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x19</span>, <span class="number">0x02</span>, <span class="number">0x32</span>, <span class="number">0x1a</span>, <span class="number">0xc6</span>, <span class="number">0x03</span>, <span class="number">0xdf</span>, <span class="number">0x33</span>, <span class="number">0xee</span>, <span class="number">0x1b</span>, <span class="number">0x68</span>, <span class="number">0xc7</span>, <span class="number">0x4b</span>,</span><br><span class="line">    <span class="number">0x04</span>, <span class="number">0x64</span>, <span class="number">0xe0</span>, <span class="number">0x0e</span>, <span class="number">0x34</span>, <span class="number">0x8d</span>, <span class="number">0xef</span>, <span class="number">0x81</span>, <span class="number">0x1c</span>, <span class="number">0xc1</span>, <span class="number">0x69</span>, <span class="number">0xf8</span>, <span class="number">0xc8</span>, <span class="number">0x08</span>, <span class="number">0x4c</span>, <span class="number">0x71</span>,</span><br><span class="line">    <span class="number">0x05</span>, <span class="number">0x8a</span>, <span class="number">0x65</span>, <span class="number">0x2f</span>, <span class="number">0xe1</span>, <span class="number">0x24</span>, <span class="number">0x0f</span>, <span class="number">0x21</span>, <span class="number">0x35</span>, <span class="number">0x93</span>, <span class="number">0x8e</span>, <span class="number">0xda</span>, <span class="number">0xf0</span>, <span class="number">0x12</span>, <span class="number">0x82</span>, <span class="number">0x45</span>,</span><br><span class="line">    <span class="number">0x1d</span>, <span class="number">0xb5</span>, <span class="number">0xc2</span>, <span class="number">0x7d</span>, <span class="number">0x6a</span>, <span class="number">0x27</span>, <span class="number">0xf9</span>, <span class="number">0xb9</span>, <span class="number">0xc9</span>, <span class="number">0x9a</span>, <span class="number">0x09</span>, <span class="number">0x78</span>, <span class="number">0x4d</span>, <span class="number">0xe4</span>, <span class="number">0x72</span>, <span class="number">0xa6</span>,</span><br><span class="line">    <span class="number">0x06</span>, <span class="number">0xbf</span>, <span class="number">0x8b</span>, <span class="number">0x62</span>, <span class="number">0x66</span>, <span class="number">0xdd</span>, <span class="number">0x30</span>, <span class="number">0xfd</span>, <span class="number">0xe2</span>, <span class="number">0x98</span>, <span class="number">0x25</span>, <span class="number">0xb3</span>, <span class="number">0x10</span>, <span class="number">0x91</span>, <span class="number">0x22</span>, <span class="number">0x88</span>,</span><br><span class="line">    <span class="number">0x36</span>, <span class="number">0xd0</span>, <span class="number">0x94</span>, <span class="number">0xce</span>, <span class="number">0x8f</span>, <span class="number">0x96</span>, <span class="number">0xdb</span>, <span class="number">0xbd</span>, <span class="number">0xf1</span>, <span class="number">0xd2</span>, <span class="number">0x13</span>, <span class="number">0x5c</span>, <span class="number">0x83</span>, <span class="number">0x38</span>, <span class="number">0x46</span>, <span class="number">0x40</span>,</span><br><span class="line">    <span class="number">0x1e</span>, <span class="number">0x42</span>, <span class="number">0xb6</span>, <span class="number">0xa3</span>, <span class="number">0xc3</span>, <span class="number">0x48</span>, <span class="number">0x7e</span>, <span class="number">0x6e</span>, <span class="number">0x6b</span>, <span class="number">0x3a</span>, <span class="number">0x28</span>, <span class="number">0x54</span>, <span class="number">0xfa</span>, <span class="number">0x85</span>, <span class="number">0xba</span>, <span class="number">0x3d</span>,</span><br><span class="line">    <span class="number">0xca</span>, <span class="number">0x5e</span>, <span class="number">0x9b</span>, <span class="number">0x9f</span>, <span class="number">0x0a</span>, <span class="number">0x15</span>, <span class="number">0x79</span>, <span class="number">0x2b</span>, <span class="number">0x4e</span>, <span class="number">0xd4</span>, <span class="number">0xe5</span>, <span class="number">0xac</span>, <span class="number">0x73</span>, <span class="number">0xf3</span>, <span class="number">0xa7</span>, <span class="number">0x57</span>,</span><br><span class="line">    <span class="number">0x07</span>, <span class="number">0x70</span>, <span class="number">0xc0</span>, <span class="number">0xf7</span>, <span class="number">0x8c</span>, <span class="number">0x80</span>, <span class="number">0x63</span>, <span class="number">0x0d</span>, <span class="number">0x67</span>, <span class="number">0x4a</span>, <span class="number">0xde</span>, <span class="number">0xed</span>, <span class="number">0x31</span>, <span class="number">0xc5</span>, <span class="number">0xfe</span>, <span class="number">0x18</span>,</span><br><span class="line">    <span class="number">0xe3</span>, <span class="number">0xa5</span>, <span class="number">0x99</span>, <span class="number">0x77</span>, <span class="number">0x26</span>, <span class="number">0xb8</span>, <span class="number">0xb4</span>, <span class="number">0x7c</span>, <span class="number">0x11</span>, <span class="number">0x44</span>, <span class="number">0x92</span>, <span class="number">0xd9</span>, <span class="number">0x23</span>, <span class="number">0x20</span>, <span class="number">0x89</span>, <span class="number">0x2e</span>,</span><br><span class="line">    <span class="number">0x37</span>, <span class="number">0x3f</span>, <span class="number">0xd1</span>, <span class="number">0x5b</span>, <span class="number">0x95</span>, <span class="number">0xbc</span>, <span class="number">0xcf</span>, <span class="number">0xcd</span>, <span class="number">0x90</span>, <span class="number">0x87</span>, <span class="number">0x97</span>, <span class="number">0xb2</span>, <span class="number">0xdc</span>, <span class="number">0xfc</span>, <span class="number">0xbe</span>, <span class="number">0x61</span>,</span><br><span class="line">    <span class="number">0xf2</span>, <span class="number">0x56</span>, <span class="number">0xd3</span>, <span class="number">0xab</span>, <span class="number">0x14</span>, <span class="number">0x2a</span>, <span class="number">0x5d</span>, <span class="number">0x9e</span>, <span class="number">0x84</span>, <span class="number">0x3c</span>, <span class="number">0x39</span>, <span class="number">0x53</span>, <span class="number">0x47</span>, <span class="number">0x6d</span>, <span class="number">0x41</span>, <span class="number">0xa2</span>,</span><br><span class="line">    <span class="number">0x1f</span>, <span class="number">0x2d</span>, <span class="number">0x43</span>, <span class="number">0xd8</span>, <span class="number">0xb7</span>, <span class="number">0x7b</span>, <span class="number">0xa4</span>, <span class="number">0x76</span>, <span class="number">0xc4</span>, <span class="number">0x17</span>, <span class="number">0x49</span>, <span class="number">0xec</span>, <span class="number">0x7f</span>, <span class="number">0x0c</span>, <span class="number">0x6f</span>, <span class="number">0xf6</span>,</span><br><span class="line">    <span class="number">0x6c</span>, <span class="number">0xa1</span>, <span class="number">0x3b</span>, <span class="number">0x52</span>, <span class="number">0x29</span>, <span class="number">0x9d</span>, <span class="number">0x55</span>, <span class="number">0xaa</span>, <span class="number">0xfb</span>, <span class="number">0x60</span>, <span class="number">0x86</span>, <span class="number">0xb1</span>, <span class="number">0xbb</span>, <span class="number">0xcc</span>, <span class="number">0x3e</span>, <span class="number">0x5a</span>,</span><br><span class="line">    <span class="number">0xcb</span>, <span class="number">0x59</span>, <span class="number">0x5f</span>, <span class="number">0xb0</span>, <span class="number">0x9c</span>, <span class="number">0xa9</span>, <span class="number">0xa0</span>, <span class="number">0x51</span>, <span class="number">0x0b</span>, <span class="number">0xf5</span>, <span class="number">0x16</span>, <span class="number">0xeb</span>, <span class="number">0x7a</span>, <span class="number">0x75</span>, <span class="number">0x2c</span>, <span class="number">0xd7</span>,</span><br><span class="line">    <span class="number">0x4f</span>, <span class="number">0xae</span>, <span class="number">0xd5</span>, <span class="number">0xe9</span>, <span class="number">0xe6</span>, <span class="number">0xe7</span>, <span class="number">0xad</span>, <span class="number">0xe8</span>, <span class="number">0x74</span>, <span class="number">0xd6</span>, <span class="number">0xf4</span>, <span class="number">0xea</span>, <span class="number">0xa8</span>, <span class="number">0x50</span>, <span class="number">0x58</span>, <span class="number">0xaf</span></span><br><span class="line">  ];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Galios field exponent table</span></span><br><span class="line">  <span class="keyword">var</span> gexp = [</span><br><span class="line">    <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x04</span>, <span class="number">0x08</span>, <span class="number">0x10</span>, <span class="number">0x20</span>, <span class="number">0x40</span>, <span class="number">0x80</span>, <span class="number">0x1d</span>, <span class="number">0x3a</span>, <span class="number">0x74</span>, <span class="number">0xe8</span>, <span class="number">0xcd</span>, <span class="number">0x87</span>, <span class="number">0x13</span>, <span class="number">0x26</span>,</span><br><span class="line">    <span class="number">0x4c</span>, <span class="number">0x98</span>, <span class="number">0x2d</span>, <span class="number">0x5a</span>, <span class="number">0xb4</span>, <span class="number">0x75</span>, <span class="number">0xea</span>, <span class="number">0xc9</span>, <span class="number">0x8f</span>, <span class="number">0x03</span>, <span class="number">0x06</span>, <span class="number">0x0c</span>, <span class="number">0x18</span>, <span class="number">0x30</span>, <span class="number">0x60</span>, <span class="number">0xc0</span>,</span><br><span class="line">    <span class="number">0x9d</span>, <span class="number">0x27</span>, <span class="number">0x4e</span>, <span class="number">0x9c</span>, <span class="number">0x25</span>, <span class="number">0x4a</span>, <span class="number">0x94</span>, <span class="number">0x35</span>, <span class="number">0x6a</span>, <span class="number">0xd4</span>, <span class="number">0xb5</span>, <span class="number">0x77</span>, <span class="number">0xee</span>, <span class="number">0xc1</span>, <span class="number">0x9f</span>, <span class="number">0x23</span>,</span><br><span class="line">    <span class="number">0x46</span>, <span class="number">0x8c</span>, <span class="number">0x05</span>, <span class="number">0x0a</span>, <span class="number">0x14</span>, <span class="number">0x28</span>, <span class="number">0x50</span>, <span class="number">0xa0</span>, <span class="number">0x5d</span>, <span class="number">0xba</span>, <span class="number">0x69</span>, <span class="number">0xd2</span>, <span class="number">0xb9</span>, <span class="number">0x6f</span>, <span class="number">0xde</span>, <span class="number">0xa1</span>,</span><br><span class="line">    <span class="number">0x5f</span>, <span class="number">0xbe</span>, <span class="number">0x61</span>, <span class="number">0xc2</span>, <span class="number">0x99</span>, <span class="number">0x2f</span>, <span class="number">0x5e</span>, <span class="number">0xbc</span>, <span class="number">0x65</span>, <span class="number">0xca</span>, <span class="number">0x89</span>, <span class="number">0x0f</span>, <span class="number">0x1e</span>, <span class="number">0x3c</span>, <span class="number">0x78</span>, <span class="number">0xf0</span>,</span><br><span class="line">    <span class="number">0xfd</span>, <span class="number">0xe7</span>, <span class="number">0xd3</span>, <span class="number">0xbb</span>, <span class="number">0x6b</span>, <span class="number">0xd6</span>, <span class="number">0xb1</span>, <span class="number">0x7f</span>, <span class="number">0xfe</span>, <span class="number">0xe1</span>, <span class="number">0xdf</span>, <span class="number">0xa3</span>, <span class="number">0x5b</span>, <span class="number">0xb6</span>, <span class="number">0x71</span>, <span class="number">0xe2</span>,</span><br><span class="line">    <span class="number">0xd9</span>, <span class="number">0xaf</span>, <span class="number">0x43</span>, <span class="number">0x86</span>, <span class="number">0x11</span>, <span class="number">0x22</span>, <span class="number">0x44</span>, <span class="number">0x88</span>, <span class="number">0x0d</span>, <span class="number">0x1a</span>, <span class="number">0x34</span>, <span class="number">0x68</span>, <span class="number">0xd0</span>, <span class="number">0xbd</span>, <span class="number">0x67</span>, <span class="number">0xce</span>,</span><br><span class="line">    <span class="number">0x81</span>, <span class="number">0x1f</span>, <span class="number">0x3e</span>, <span class="number">0x7c</span>, <span class="number">0xf8</span>, <span class="number">0xed</span>, <span class="number">0xc7</span>, <span class="number">0x93</span>, <span class="number">0x3b</span>, <span class="number">0x76</span>, <span class="number">0xec</span>, <span class="number">0xc5</span>, <span class="number">0x97</span>, <span class="number">0x33</span>, <span class="number">0x66</span>, <span class="number">0xcc</span>,</span><br><span class="line">    <span class="number">0x85</span>, <span class="number">0x17</span>, <span class="number">0x2e</span>, <span class="number">0x5c</span>, <span class="number">0xb8</span>, <span class="number">0x6d</span>, <span class="number">0xda</span>, <span class="number">0xa9</span>, <span class="number">0x4f</span>, <span class="number">0x9e</span>, <span class="number">0x21</span>, <span class="number">0x42</span>, <span class="number">0x84</span>, <span class="number">0x15</span>, <span class="number">0x2a</span>, <span class="number">0x54</span>,</span><br><span class="line">    <span class="number">0xa8</span>, <span class="number">0x4d</span>, <span class="number">0x9a</span>, <span class="number">0x29</span>, <span class="number">0x52</span>, <span class="number">0xa4</span>, <span class="number">0x55</span>, <span class="number">0xaa</span>, <span class="number">0x49</span>, <span class="number">0x92</span>, <span class="number">0x39</span>, <span class="number">0x72</span>, <span class="number">0xe4</span>, <span class="number">0xd5</span>, <span class="number">0xb7</span>, <span class="number">0x73</span>,</span><br><span class="line">    <span class="number">0xe6</span>, <span class="number">0xd1</span>, <span class="number">0xbf</span>, <span class="number">0x63</span>, <span class="number">0xc6</span>, <span class="number">0x91</span>, <span class="number">0x3f</span>, <span class="number">0x7e</span>, <span class="number">0xfc</span>, <span class="number">0xe5</span>, <span class="number">0xd7</span>, <span class="number">0xb3</span>, <span class="number">0x7b</span>, <span class="number">0xf6</span>, <span class="number">0xf1</span>, <span class="number">0xff</span>,</span><br><span class="line">    <span class="number">0xe3</span>, <span class="number">0xdb</span>, <span class="number">0xab</span>, <span class="number">0x4b</span>, <span class="number">0x96</span>, <span class="number">0x31</span>, <span class="number">0x62</span>, <span class="number">0xc4</span>, <span class="number">0x95</span>, <span class="number">0x37</span>, <span class="number">0x6e</span>, <span class="number">0xdc</span>, <span class="number">0xa5</span>, <span class="number">0x57</span>, <span class="number">0xae</span>, <span class="number">0x41</span>,</span><br><span class="line">    <span class="number">0x82</span>, <span class="number">0x19</span>, <span class="number">0x32</span>, <span class="number">0x64</span>, <span class="number">0xc8</span>, <span class="number">0x8d</span>, <span class="number">0x07</span>, <span class="number">0x0e</span>, <span class="number">0x1c</span>, <span class="number">0x38</span>, <span class="number">0x70</span>, <span class="number">0xe0</span>, <span class="number">0xdd</span>, <span class="number">0xa7</span>, <span class="number">0x53</span>, <span class="number">0xa6</span>,</span><br><span class="line">    <span class="number">0x51</span>, <span class="number">0xa2</span>, <span class="number">0x59</span>, <span class="number">0xb2</span>, <span class="number">0x79</span>, <span class="number">0xf2</span>, <span class="number">0xf9</span>, <span class="number">0xef</span>, <span class="number">0xc3</span>, <span class="number">0x9b</span>, <span class="number">0x2b</span>, <span class="number">0x56</span>, <span class="number">0xac</span>, <span class="number">0x45</span>, <span class="number">0x8a</span>, <span class="number">0x09</span>,</span><br><span class="line">    <span class="number">0x12</span>, <span class="number">0x24</span>, <span class="number">0x48</span>, <span class="number">0x90</span>, <span class="number">0x3d</span>, <span class="number">0x7a</span>, <span class="number">0xf4</span>, <span class="number">0xf5</span>, <span class="number">0xf7</span>, <span class="number">0xf3</span>, <span class="number">0xfb</span>, <span class="number">0xeb</span>, <span class="number">0xcb</span>, <span class="number">0x8b</span>, <span class="number">0x0b</span>, <span class="number">0x16</span>,</span><br><span class="line">    <span class="number">0x2c</span>, <span class="number">0x58</span>, <span class="number">0xb0</span>, <span class="number">0x7d</span>, <span class="number">0xfa</span>, <span class="number">0xe9</span>, <span class="number">0xcf</span>, <span class="number">0x83</span>, <span class="number">0x1b</span>, <span class="number">0x36</span>, <span class="number">0x6c</span>, <span class="number">0xd8</span>, <span class="number">0xad</span>, <span class="number">0x47</span>, <span class="number">0x8e</span>, <span class="number">0x00</span></span><br><span class="line">  ];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Working buffers:</span></span><br><span class="line">  <span class="comment">// data input and ecc append, image working buffer, fixed part of image, run lengths for badness</span></span><br><span class="line">  <span class="keyword">var</span> strinbuf = [], eccbuf = [], qrframe = [], framask = [], rlens = [];</span><br><span class="line">  <span class="comment">// Control values - width is based on version, last 4 are from table.</span></span><br><span class="line">  <span class="keyword">var</span> version, width, neccblk1, neccblk2, datablkw, eccblkwid;</span><br><span class="line">  <span class="keyword">var</span> ecclevel = <span class="number">2</span>;</span><br><span class="line">  <span class="comment">// set bit to indicate cell in qrframe is immutable.  symmetric around diagonal</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">setmask</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> bt;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; y) &#123;</span><br><span class="line">      bt = x;</span><br><span class="line">      x = y;</span><br><span class="line">      y = bt;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// y*y = 1+3+5...</span></span><br><span class="line">    bt = y;</span><br><span class="line">    bt *= y;</span><br><span class="line">    bt += y;</span><br><span class="line">    bt &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">    bt += x;</span><br><span class="line">    framask[bt] = <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// enter alignment pattern - black to qrframe, white to mask (later black frame merged to mask)</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">putalign</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> j;</span><br><span class="line"></span><br><span class="line">    qrframe[x + width * y] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (j = <span class="number">-2</span>; j &lt; <span class="number">2</span>; j++) &#123;</span><br><span class="line">      qrframe[(x + j) + width * (y - <span class="number">2</span>)] = <span class="number">1</span>;</span><br><span class="line">      qrframe[(x - <span class="number">2</span>) + width * (y + j + <span class="number">1</span>)] = <span class="number">1</span>;</span><br><span class="line">      qrframe[(x + <span class="number">2</span>) + width * (y + j)] = <span class="number">1</span>;</span><br><span class="line">      qrframe[(x + j + <span class="number">1</span>) + width * (y + <span class="number">2</span>)] = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">2</span>; j++) &#123;</span><br><span class="line">      setmask(x - <span class="number">1</span>, y + j);</span><br><span class="line">      setmask(x + <span class="number">1</span>, y - j);</span><br><span class="line">      setmask(x - j, y - <span class="number">1</span>);</span><br><span class="line">      setmask(x + j, y + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//========================================================================</span></span><br><span class="line">  <span class="comment">// Reed Solomon error correction</span></span><br><span class="line">  <span class="comment">// exponentiation mod N</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">modnn</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (x &gt;= <span class="number">255</span>) &#123;</span><br><span class="line">      x -= <span class="number">255</span>;</span><br><span class="line">      x = (x &gt;&gt; <span class="number">8</span>) + (x &amp; <span class="number">255</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> x;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> genpoly = [];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Calculate and append ECC data to data block.  Block is in strinbuf, indexes to buffers given.</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">appendrs</span>(<span class="params">data, dlen, ecbuf, eclen</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> i, j, fb;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; eclen; i++)</span><br><span class="line">      strinbuf[ecbuf + i] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; dlen; i++) &#123;</span><br><span class="line">      fb = glog[strinbuf[data + i] ^ strinbuf[ecbuf]];</span><br><span class="line">      <span class="keyword">if</span> (fb != <span class="number">255</span>)     <span class="comment">/* fb term is non-zero */</span></span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">1</span>; j &lt; eclen; j++)</span><br><span class="line">          strinbuf[ecbuf + j - <span class="number">1</span>] = strinbuf[ecbuf + j] ^ gexp[modnn(fb + genpoly[eclen - j])];</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">for</span> (j = ecbuf; j &lt; ecbuf + eclen; j++)</span><br><span class="line">          strinbuf[j] = strinbuf[j + <span class="number">1</span>];</span><br><span class="line">      strinbuf[ecbuf + eclen - <span class="number">1</span>] = fb == <span class="number">255</span> ? <span class="number">0</span> : gexp[modnn(fb + genpoly[<span class="number">0</span>])];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//========================================================================</span></span><br><span class="line">  <span class="comment">// Frame data insert following the path rules</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// check mask - since symmetrical use half.</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">ismasked</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> bt;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; y) &#123;</span><br><span class="line">      bt = x;</span><br><span class="line">      x = y;</span><br><span class="line">      y = bt;</span><br><span class="line">    &#125;</span><br><span class="line">    bt = y;</span><br><span class="line">    bt += y * y;</span><br><span class="line">    bt &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">    bt += x;</span><br><span class="line">    <span class="keyword">return</span> framask[bt];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//========================================================================</span></span><br><span class="line">  <span class="comment">//  Apply the selected mask out of the 8.</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">applymask</span>(<span class="params">m</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> x, y, r3x, r3y;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span> (m) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">for</span> (y = <span class="number">0</span>; y &lt; width; y++)</span><br><span class="line">          <span class="keyword">for</span> (x = <span class="number">0</span>; x &lt; width; x++)</span><br><span class="line">            <span class="keyword">if</span> (!((x + y) &amp; <span class="number">1</span>) &amp;&amp; !ismasked(x, y))</span><br><span class="line">              qrframe[x + y * width] ^= <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">for</span> (y = <span class="number">0</span>; y &lt; width; y++)</span><br><span class="line">          <span class="keyword">for</span> (x = <span class="number">0</span>; x &lt; width; x++)</span><br><span class="line">            <span class="keyword">if</span> (!(y &amp; <span class="number">1</span>) &amp;&amp; !ismasked(x, y))</span><br><span class="line">              qrframe[x + y * width] ^= <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">for</span> (y = <span class="number">0</span>; y &lt; width; y++)</span><br><span class="line">          <span class="keyword">for</span> (r3x = <span class="number">0</span>, x = <span class="number">0</span>; x &lt; width; x++ , r3x++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (r3x == <span class="number">3</span>)</span><br><span class="line">              r3x = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span> (!r3x &amp;&amp; !ismasked(x, y))</span><br><span class="line">              qrframe[x + y * width] ^= <span class="number">1</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">for</span> (r3y = <span class="number">0</span>, y = <span class="number">0</span>; y &lt; width; y++ , r3y++) &#123;</span><br><span class="line">          <span class="keyword">if</span> (r3y == <span class="number">3</span>)</span><br><span class="line">            r3y = <span class="number">0</span>;</span><br><span class="line">          <span class="keyword">for</span> (r3x = r3y, x = <span class="number">0</span>; x &lt; width; x++ , r3x++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (r3x == <span class="number">3</span>)</span><br><span class="line">              r3x = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span> (!r3x &amp;&amp; !ismasked(x, y))</span><br><span class="line">              qrframe[x + y * width] ^= <span class="number">1</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">        <span class="keyword">for</span> (y = <span class="number">0</span>; y &lt; width; y++)</span><br><span class="line">          <span class="keyword">for</span> (r3x = <span class="number">0</span>, r3y = ((y &gt;&gt; <span class="number">1</span>) &amp; <span class="number">1</span>), x = <span class="number">0</span>; x &lt; width; x++ , r3x++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (r3x == <span class="number">3</span>) &#123;</span><br><span class="line">              r3x = <span class="number">0</span>;</span><br><span class="line">              r3y = !r3y;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (!r3y &amp;&amp; !ismasked(x, y))</span><br><span class="line">              qrframe[x + y * width] ^= <span class="number">1</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">        <span class="keyword">for</span> (r3y = <span class="number">0</span>, y = <span class="number">0</span>; y &lt; width; y++ , r3y++) &#123;</span><br><span class="line">          <span class="keyword">if</span> (r3y == <span class="number">3</span>)</span><br><span class="line">            r3y = <span class="number">0</span>;</span><br><span class="line">          <span class="keyword">for</span> (r3x = <span class="number">0</span>, x = <span class="number">0</span>; x &lt; width; x++ , r3x++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (r3x == <span class="number">3</span>)</span><br><span class="line">              r3x = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span> (!((x &amp; y &amp; <span class="number">1</span>) + !(!r3x | !r3y)) &amp;&amp; !ismasked(x, y))</span><br><span class="line">              qrframe[x + y * width] ^= <span class="number">1</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">        <span class="keyword">for</span> (r3y = <span class="number">0</span>, y = <span class="number">0</span>; y &lt; width; y++ , r3y++) &#123;</span><br><span class="line">          <span class="keyword">if</span> (r3y == <span class="number">3</span>)</span><br><span class="line">            r3y = <span class="number">0</span>;</span><br><span class="line">          <span class="keyword">for</span> (r3x = <span class="number">0</span>, x = <span class="number">0</span>; x &lt; width; x++ , r3x++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (r3x == <span class="number">3</span>)</span><br><span class="line">              r3x = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span> (!(((x &amp; y &amp; <span class="number">1</span>) + (r3x &amp;&amp; (r3x == r3y))) &amp; <span class="number">1</span>) &amp;&amp; !ismasked(x, y))</span><br><span class="line">              qrframe[x + y * width] ^= <span class="number">1</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">7</span>:</span><br><span class="line">        <span class="keyword">for</span> (r3y = <span class="number">0</span>, y = <span class="number">0</span>; y &lt; width; y++ , r3y++) &#123;</span><br><span class="line">          <span class="keyword">if</span> (r3y == <span class="number">3</span>)</span><br><span class="line">            r3y = <span class="number">0</span>;</span><br><span class="line">          <span class="keyword">for</span> (r3x = <span class="number">0</span>, x = <span class="number">0</span>; x &lt; width; x++ , r3x++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (r3x == <span class="number">3</span>)</span><br><span class="line">              r3x = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span> (!(((r3x &amp;&amp; (r3x == r3y)) + ((x + y) &amp; <span class="number">1</span>)) &amp; <span class="number">1</span>) &amp;&amp; !ismasked(x, y))</span><br><span class="line">              qrframe[x + y * width] ^= <span class="number">1</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Badness coefficients.</span></span><br><span class="line">  <span class="keyword">var</span> N1 = <span class="number">3</span>, N2 = <span class="number">3</span>, N3 = <span class="number">40</span>, N4 = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Using the table of the length of each run, calculate the amount of bad image </span></span><br><span class="line">  <span class="comment">// - long runs or those that look like finders; called twice, once each for X and Y</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">badruns</span>(<span class="params">length</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> i;</span><br><span class="line">    <span class="keyword">var</span> runsbad = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt;= length; i++)</span><br><span class="line">      <span class="keyword">if</span> (rlens[i] &gt;= <span class="number">5</span>)</span><br><span class="line">        runsbad += N1 + rlens[i] - <span class="number">5</span>;</span><br><span class="line">    <span class="comment">// BwBBBwB as in finder</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">3</span>; i &lt; length - <span class="number">1</span>; i += <span class="number">2</span>)</span><br><span class="line">      <span class="keyword">if</span> (rlens[i - <span class="number">2</span>] == rlens[i + <span class="number">2</span>]</span><br><span class="line">        &amp;&amp; rlens[i + <span class="number">2</span>] == rlens[i - <span class="number">1</span>]</span><br><span class="line">        &amp;&amp; rlens[i - <span class="number">1</span>] == rlens[i + <span class="number">1</span>]</span><br><span class="line">        &amp;&amp; rlens[i - <span class="number">1</span>] * <span class="number">3</span> == rlens[i]</span><br><span class="line">        <span class="comment">// white around the black pattern? Not part of spec</span></span><br><span class="line">        &amp;&amp; (rlens[i - <span class="number">3</span>] == <span class="number">0</span> <span class="comment">// beginning</span></span><br><span class="line">          || i + <span class="number">3</span> &gt; length  <span class="comment">// end</span></span><br><span class="line">          || rlens[i - <span class="number">3</span>] * <span class="number">3</span> &gt;= rlens[i] * <span class="number">4</span> || rlens[i + <span class="number">3</span>] * <span class="number">3</span> &gt;= rlens[i] * <span class="number">4</span>)</span><br><span class="line">      )</span><br><span class="line">        runsbad += N3;</span><br><span class="line">    <span class="keyword">return</span> runsbad;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Calculate how bad the masked image is - blocks, imbalance, runs, or finders.</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">badcheck</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> x, y, h, b, b1;</span><br><span class="line">    <span class="keyword">var</span> thisbad = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> bw = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// blocks of same color.</span></span><br><span class="line">    <span class="keyword">for</span> (y = <span class="number">0</span>; y &lt; width - <span class="number">1</span>; y++)</span><br><span class="line">      <span class="keyword">for</span> (x = <span class="number">0</span>; x &lt; width - <span class="number">1</span>; x++)</span><br><span class="line">        <span class="keyword">if</span> ((qrframe[x + width * y] &amp;&amp; qrframe[(x + <span class="number">1</span>) + width * y]</span><br><span class="line">          &amp;&amp; qrframe[x + width * (y + <span class="number">1</span>)] &amp;&amp; qrframe[(x + <span class="number">1</span>) + width * (y + <span class="number">1</span>)]) <span class="comment">// all black</span></span><br><span class="line">          || !(qrframe[x + width * y] || qrframe[(x + <span class="number">1</span>) + width * y]</span><br><span class="line">            || qrframe[x + width * (y + <span class="number">1</span>)] || qrframe[(x + <span class="number">1</span>) + width * (y + <span class="number">1</span>)])) <span class="comment">// all white</span></span><br><span class="line">          thisbad += N2;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// X runs</span></span><br><span class="line">    <span class="keyword">for</span> (y = <span class="number">0</span>; y &lt; width; y++) &#123;</span><br><span class="line">      rlens[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">for</span> (h = b = x = <span class="number">0</span>; x &lt; width; x++) &#123;</span><br><span class="line">        <span class="keyword">if</span> ((b1 = qrframe[x + width * y]) == b)</span><br><span class="line">          rlens[h]++;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">          rlens[++h] = <span class="number">1</span>;</span><br><span class="line">        b = b1;</span><br><span class="line">        bw += b ? <span class="number">1</span> : <span class="number">-1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      thisbad += badruns(h);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// black/white imbalance</span></span><br><span class="line">    <span class="keyword">if</span> (bw &lt; <span class="number">0</span>)</span><br><span class="line">      bw = -bw;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> big = bw;</span><br><span class="line">    <span class="keyword">var</span> count = <span class="number">0</span>;</span><br><span class="line">    big += big &lt;&lt; <span class="number">2</span>;</span><br><span class="line">    big &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (big &gt; width * width)</span><br><span class="line">      big -= width * width, count++;</span><br><span class="line">    thisbad += count * N4;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Y runs</span></span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; x &lt; width; x++) &#123;</span><br><span class="line">      rlens[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">for</span> (h = b = y = <span class="number">0</span>; y &lt; width; y++) &#123;</span><br><span class="line">        <span class="keyword">if</span> ((b1 = qrframe[x + width * y]) == b)</span><br><span class="line">          rlens[h]++;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">          rlens[++h] = <span class="number">1</span>;</span><br><span class="line">        b = b1;</span><br><span class="line">      &#125;</span><br><span class="line">      thisbad += badruns(h);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> thisbad;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">genframe</span>(<span class="params">instring</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> x, y, k, t, v, i, j, m;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// find the smallest version that fits the string</span></span><br><span class="line">    t = instring.length;</span><br><span class="line">    version = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">      version++;</span><br><span class="line">      k = (ecclevel - <span class="number">1</span>) * <span class="number">4</span> + (version - <span class="number">1</span>) * <span class="number">16</span>;</span><br><span class="line">      neccblk1 = eccblocks[k++];</span><br><span class="line">      neccblk2 = eccblocks[k++];</span><br><span class="line">      datablkw = eccblocks[k++];</span><br><span class="line">      eccblkwid = eccblocks[k];</span><br><span class="line">      k = datablkw * (neccblk1 + neccblk2) + neccblk2 - <span class="number">3</span> + (version &lt;= <span class="number">9</span>);</span><br><span class="line">      <span class="keyword">if</span> (t &lt;= k)</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125; <span class="keyword">while</span> (version &lt; <span class="number">40</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// FIXME - insure that it fits insted of being truncated</span></span><br><span class="line">    width = <span class="number">17</span> + <span class="number">4</span> * version;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// allocate, clear and setup data structures</span></span><br><span class="line">    v = datablkw + (datablkw + eccblkwid) * (neccblk1 + neccblk2) + neccblk2;</span><br><span class="line">    <span class="keyword">for</span> (t = <span class="number">0</span>; t &lt; v; t++)</span><br><span class="line">      eccbuf[t] = <span class="number">0</span>;</span><br><span class="line">    strinbuf = instring.slice(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (t = <span class="number">0</span>; t &lt; width * width; t++)</span><br><span class="line">      qrframe[t] = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (t = <span class="number">0</span>; t &lt; (width * (width + <span class="number">1</span>) + <span class="number">1</span>) / <span class="number">2</span>; t++)</span><br><span class="line">      framask[t] = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// insert finders - black to frame, white to mask</span></span><br><span class="line">    <span class="keyword">for</span> (t = <span class="number">0</span>; t &lt; <span class="number">3</span>; t++) &#123;</span><br><span class="line">      k = <span class="number">0</span>;</span><br><span class="line">      y = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">if</span> (t == <span class="number">1</span>)</span><br><span class="line">        k = (width - <span class="number">7</span>);</span><br><span class="line">      <span class="keyword">if</span> (t == <span class="number">2</span>)</span><br><span class="line">        y = (width - <span class="number">7</span>);</span><br><span class="line">      qrframe[(y + <span class="number">3</span>) + width * (k + <span class="number">3</span>)] = <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">for</span> (x = <span class="number">0</span>; x &lt; <span class="number">6</span>; x++) &#123;</span><br><span class="line">        qrframe[(y + x) + width * k] = <span class="number">1</span>;</span><br><span class="line">        qrframe[y + width * (k + x + <span class="number">1</span>)] = <span class="number">1</span>;</span><br><span class="line">        qrframe[(y + <span class="number">6</span>) + width * (k + x)] = <span class="number">1</span>;</span><br><span class="line">        qrframe[(y + x + <span class="number">1</span>) + width * (k + <span class="number">6</span>)] = <span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">for</span> (x = <span class="number">1</span>; x &lt; <span class="number">5</span>; x++) &#123;</span><br><span class="line">        setmask(y + x, k + <span class="number">1</span>);</span><br><span class="line">        setmask(y + <span class="number">1</span>, k + x + <span class="number">1</span>);</span><br><span class="line">        setmask(y + <span class="number">5</span>, k + x);</span><br><span class="line">        setmask(y + x + <span class="number">1</span>, k + <span class="number">5</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">for</span> (x = <span class="number">2</span>; x &lt; <span class="number">4</span>; x++) &#123;</span><br><span class="line">        qrframe[(y + x) + width * (k + <span class="number">2</span>)] = <span class="number">1</span>;</span><br><span class="line">        qrframe[(y + <span class="number">2</span>) + width * (k + x + <span class="number">1</span>)] = <span class="number">1</span>;</span><br><span class="line">        qrframe[(y + <span class="number">4</span>) + width * (k + x)] = <span class="number">1</span>;</span><br><span class="line">        qrframe[(y + x + <span class="number">1</span>) + width * (k + <span class="number">4</span>)] = <span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// alignment blocks</span></span><br><span class="line">    <span class="keyword">if</span> (version &gt; <span class="number">1</span>) &#123;</span><br><span class="line">      t = adelta[version];</span><br><span class="line">      y = width - <span class="number">7</span>;</span><br><span class="line">      <span class="keyword">for</span> (; ;) &#123;</span><br><span class="line">        x = width - <span class="number">7</span>;</span><br><span class="line">        <span class="keyword">while</span> (x &gt; t - <span class="number">3</span>) &#123;</span><br><span class="line">          putalign(x, y);</span><br><span class="line">          <span class="keyword">if</span> (x &lt; t)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          x -= t;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (y &lt;= t + <span class="number">9</span>)</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        y -= t;</span><br><span class="line">        putalign(<span class="number">6</span>, y);</span><br><span class="line">        putalign(y, <span class="number">6</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// single black</span></span><br><span class="line">    qrframe[<span class="number">8</span> + width * (width - <span class="number">8</span>)] = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// timing gap - mask only</span></span><br><span class="line">    <span class="keyword">for</span> (y = <span class="number">0</span>; y &lt; <span class="number">7</span>; y++) &#123;</span><br><span class="line">      setmask(<span class="number">7</span>, y);</span><br><span class="line">      setmask(width - <span class="number">8</span>, y);</span><br><span class="line">      setmask(<span class="number">7</span>, y + width - <span class="number">7</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; x &lt; <span class="number">8</span>; x++) &#123;</span><br><span class="line">      setmask(x, <span class="number">7</span>);</span><br><span class="line">      setmask(x + width - <span class="number">8</span>, <span class="number">7</span>);</span><br><span class="line">      setmask(x, width - <span class="number">8</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// reserve mask-format area</span></span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; x &lt; <span class="number">9</span>; x++)</span><br><span class="line">      setmask(x, <span class="number">8</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; x &lt; <span class="number">8</span>; x++) &#123;</span><br><span class="line">      setmask(x + width - <span class="number">8</span>, <span class="number">8</span>);</span><br><span class="line">      setmask(<span class="number">8</span>, x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (y = <span class="number">0</span>; y &lt; <span class="number">7</span>; y++)</span><br><span class="line">      setmask(<span class="number">8</span>, y + width - <span class="number">7</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// timing row/col</span></span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; x &lt; width - <span class="number">14</span>; x++)</span><br><span class="line">      <span class="keyword">if</span> (x &amp; <span class="number">1</span>) &#123;</span><br><span class="line">        setmask(<span class="number">8</span> + x, <span class="number">6</span>);</span><br><span class="line">        setmask(<span class="number">6</span>, <span class="number">8</span> + x);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">        qrframe[(<span class="number">8</span> + x) + width * <span class="number">6</span>] = <span class="number">1</span>;</span><br><span class="line">        qrframe[<span class="number">6</span> + width * (<span class="number">8</span> + x)] = <span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// version block</span></span><br><span class="line">    <span class="keyword">if</span> (version &gt; <span class="number">6</span>) &#123;</span><br><span class="line">      t = vpat[version - <span class="number">7</span>];</span><br><span class="line">      k = <span class="number">17</span>;</span><br><span class="line">      <span class="keyword">for</span> (x = <span class="number">0</span>; x &lt; <span class="number">6</span>; x++)</span><br><span class="line">        <span class="keyword">for</span> (y = <span class="number">0</span>; y &lt; <span class="number">3</span>; y++ , k--)</span><br><span class="line">          <span class="keyword">if</span> (<span class="number">1</span> &amp; (k &gt; <span class="number">11</span> ? version &gt;&gt; (k - <span class="number">12</span>) : t &gt;&gt; k)) &#123;</span><br><span class="line">            qrframe[(<span class="number">5</span> - x) + width * (<span class="number">2</span> - y + width - <span class="number">11</span>)] = <span class="number">1</span>;</span><br><span class="line">            qrframe[(<span class="number">2</span> - y + width - <span class="number">11</span>) + width * (<span class="number">5</span> - x)] = <span class="number">1</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">else</span> &#123;</span><br><span class="line">            setmask(<span class="number">5</span> - x, <span class="number">2</span> - y + width - <span class="number">11</span>);</span><br><span class="line">            setmask(<span class="number">2</span> - y + width - <span class="number">11</span>, <span class="number">5</span> - x);</span><br><span class="line">          &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// sync mask bits - only set above for white spaces, so add in black bits</span></span><br><span class="line">    <span class="keyword">for</span> (y = <span class="number">0</span>; y &lt; width; y++)</span><br><span class="line">      <span class="keyword">for</span> (x = <span class="number">0</span>; x &lt;= y; x++)</span><br><span class="line">        <span class="keyword">if</span> (qrframe[x + width * y])</span><br><span class="line">          setmask(x, y);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// convert string to bitstream</span></span><br><span class="line">    <span class="comment">// 8 bit data to QR-coded 8 bit data (numeric or alphanum, or kanji not supported)</span></span><br><span class="line">    v = strinbuf.length;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// string to array</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; v; i++)</span><br><span class="line">      eccbuf[i] = strinbuf.charCodeAt(i);</span><br><span class="line">    strinbuf = eccbuf.slice(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// calculate max string length</span></span><br><span class="line">    x = datablkw * (neccblk1 + neccblk2) + neccblk2;</span><br><span class="line">    <span class="keyword">if</span> (v &gt;= x - <span class="number">2</span>) &#123;</span><br><span class="line">      v = x - <span class="number">2</span>;</span><br><span class="line">      <span class="keyword">if</span> (version &gt; <span class="number">9</span>)</span><br><span class="line">        v--;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// shift and repack to insert length prefix</span></span><br><span class="line">    i = v;</span><br><span class="line">    <span class="keyword">if</span> (version &gt; <span class="number">9</span>) &#123;</span><br><span class="line">      strinbuf[i + <span class="number">2</span>] = <span class="number">0</span>;</span><br><span class="line">      strinbuf[i + <span class="number">3</span>] = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">while</span> (i--) &#123;</span><br><span class="line">        t = strinbuf[i];</span><br><span class="line">        strinbuf[i + <span class="number">3</span>] |= <span class="number">255</span> &amp; (t &lt;&lt; <span class="number">4</span>);</span><br><span class="line">        strinbuf[i + <span class="number">2</span>] = t &gt;&gt; <span class="number">4</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      strinbuf[<span class="number">2</span>] |= <span class="number">255</span> &amp; (v &lt;&lt; <span class="number">4</span>);</span><br><span class="line">      strinbuf[<span class="number">1</span>] = v &gt;&gt; <span class="number">4</span>;</span><br><span class="line">      strinbuf[<span class="number">0</span>] = <span class="number">0x40</span> | (v &gt;&gt; <span class="number">12</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      strinbuf[i + <span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">      strinbuf[i + <span class="number">2</span>] = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">while</span> (i--) &#123;</span><br><span class="line">        t = strinbuf[i];</span><br><span class="line">        strinbuf[i + <span class="number">2</span>] |= <span class="number">255</span> &amp; (t &lt;&lt; <span class="number">4</span>);</span><br><span class="line">        strinbuf[i + <span class="number">1</span>] = t &gt;&gt; <span class="number">4</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      strinbuf[<span class="number">1</span>] |= <span class="number">255</span> &amp; (v &lt;&lt; <span class="number">4</span>);</span><br><span class="line">      strinbuf[<span class="number">0</span>] = <span class="number">0x40</span> | (v &gt;&gt; <span class="number">4</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// fill to end with pad pattern</span></span><br><span class="line">    i = v + <span class="number">3</span> - (version &lt; <span class="number">10</span>);</span><br><span class="line">    <span class="keyword">while</span> (i &lt; x) &#123;</span><br><span class="line">      strinbuf[i++] = <span class="number">0xec</span>;</span><br><span class="line">      <span class="comment">// buffer has room    if (i == x)      break;</span></span><br><span class="line">      strinbuf[i++] = <span class="number">0x11</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// calculate and append ECC</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// calculate generator polynomial</span></span><br><span class="line">    genpoly[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; eccblkwid; i++) &#123;</span><br><span class="line">      genpoly[i + <span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">for</span> (j = i; j &gt; <span class="number">0</span>; j--)</span><br><span class="line">        genpoly[j] = genpoly[j]</span><br><span class="line">          ? genpoly[j - <span class="number">1</span>] ^ gexp[modnn(glog[genpoly[j]] + i)] : genpoly[j - <span class="number">1</span>];</span><br><span class="line">      genpoly[<span class="number">0</span>] = gexp[modnn(glog[genpoly[<span class="number">0</span>]] + i)];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt;= eccblkwid; i++)</span><br><span class="line">      genpoly[i] = glog[genpoly[i]]; <span class="comment">// use logs for genpoly[] to save calc step</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// append ecc to data buffer</span></span><br><span class="line">    k = x;</span><br><span class="line">    y = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; neccblk1; i++) &#123;</span><br><span class="line">      appendrs(y, datablkw, k, eccblkwid);</span><br><span class="line">      y += datablkw;</span><br><span class="line">      k += eccblkwid;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; neccblk2; i++) &#123;</span><br><span class="line">      appendrs(y, datablkw + <span class="number">1</span>, k, eccblkwid);</span><br><span class="line">      y += datablkw + <span class="number">1</span>;</span><br><span class="line">      k += eccblkwid;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// interleave blocks</span></span><br><span class="line">    y = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; datablkw; i++) &#123;</span><br><span class="line">      <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; neccblk1; j++)</span><br><span class="line">        eccbuf[y++] = strinbuf[i + j * datablkw];</span><br><span class="line">      <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; neccblk2; j++)</span><br><span class="line">        eccbuf[y++] = strinbuf[(neccblk1 * datablkw) + i + (j * (datablkw + <span class="number">1</span>))];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; neccblk2; j++)</span><br><span class="line">      eccbuf[y++] = strinbuf[(neccblk1 * datablkw) + i + (j * (datablkw + <span class="number">1</span>))];</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; eccblkwid; i++)</span><br><span class="line">      <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; neccblk1 + neccblk2; j++)</span><br><span class="line">        eccbuf[y++] = strinbuf[x + i + j * eccblkwid];</span><br><span class="line">    strinbuf = eccbuf;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// pack bits into frame avoiding masked area.</span></span><br><span class="line">    x = y = width - <span class="number">1</span>;</span><br><span class="line">    k = v = <span class="number">1</span>;         <span class="comment">// up, minus</span></span><br><span class="line">    <span class="comment">/* inteleaved data and ecc codes */</span></span><br><span class="line">    m = (datablkw + eccblkwid) * (neccblk1 + neccblk2) + neccblk2;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">      t = strinbuf[i];</span><br><span class="line">      <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">8</span>; j++ , t &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">0x80</span> &amp; t)</span><br><span class="line">          qrframe[x + width * y] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">do</span> &#123;        <span class="comment">// find next fill position</span></span><br><span class="line">          <span class="keyword">if</span> (v)</span><br><span class="line">            x--;</span><br><span class="line">          <span class="keyword">else</span> &#123;</span><br><span class="line">            x++;</span><br><span class="line">            <span class="keyword">if</span> (k) &#123;</span><br><span class="line">              <span class="keyword">if</span> (y != <span class="number">0</span>)</span><br><span class="line">                y--;</span><br><span class="line">              <span class="keyword">else</span> &#123;</span><br><span class="line">                x -= <span class="number">2</span>;</span><br><span class="line">                k = !k;</span><br><span class="line">                <span class="keyword">if</span> (x == <span class="number">6</span>) &#123;</span><br><span class="line">                  x--;</span><br><span class="line">                  y = <span class="number">9</span>;</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">              <span class="keyword">if</span> (y != width - <span class="number">1</span>)</span><br><span class="line">                y++;</span><br><span class="line">              <span class="keyword">else</span> &#123;</span><br><span class="line">                x -= <span class="number">2</span>;</span><br><span class="line">                k = !k;</span><br><span class="line">                <span class="keyword">if</span> (x == <span class="number">6</span>) &#123;</span><br><span class="line">                  x--;</span><br><span class="line">                  y -= <span class="number">8</span>;</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">          v = !v;</span><br><span class="line">        &#125; <span class="keyword">while</span> (ismasked(x, y));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// save pre-mask copy of frame</span></span><br><span class="line">    strinbuf = qrframe.slice(<span class="number">0</span>);</span><br><span class="line">    t = <span class="number">0</span>;           <span class="comment">// best</span></span><br><span class="line">    y = <span class="number">30000</span>;         <span class="comment">// demerit</span></span><br><span class="line">    <span class="comment">// for instead of while since in original arduino code</span></span><br><span class="line">    <span class="comment">// if an early mask was "good enough" it wouldn't try for a better one</span></span><br><span class="line">    <span class="comment">// since they get more complex and take longer.</span></span><br><span class="line">    <span class="keyword">for</span> (k = <span class="number">0</span>; k &lt; <span class="number">8</span>; k++) &#123;</span><br><span class="line">      applymask(k);      <span class="comment">// returns black-white imbalance</span></span><br><span class="line">      x = badcheck();</span><br><span class="line">      <span class="keyword">if</span> (x &lt; y) &#123; <span class="comment">// current mask better than previous best?</span></span><br><span class="line">        y = x;</span><br><span class="line">        t = k;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (t == <span class="number">7</span>)</span><br><span class="line">        <span class="keyword">break</span>;       <span class="comment">// don't increment i to a void redoing mask</span></span><br><span class="line">      qrframe = strinbuf.slice(<span class="number">0</span>); <span class="comment">// reset for next pass</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (t != k)         <span class="comment">// redo best mask - none good enough, last wasn't t</span></span><br><span class="line">      applymask(t);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// add in final mask/ecclevel bytes</span></span><br><span class="line">    y = fmtword[t + ((ecclevel - <span class="number">1</span>) &lt;&lt; <span class="number">3</span>)];</span><br><span class="line">    <span class="comment">// low byte</span></span><br><span class="line">    <span class="keyword">for</span> (k = <span class="number">0</span>; k &lt; <span class="number">8</span>; k++ , y &gt;&gt;= <span class="number">1</span>)</span><br><span class="line">      <span class="keyword">if</span> (y &amp; <span class="number">1</span>) &#123;</span><br><span class="line">        qrframe[(width - <span class="number">1</span> - k) + width * <span class="number">8</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (k &lt; <span class="number">6</span>)</span><br><span class="line">          qrframe[<span class="number">8</span> + width * k] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">          qrframe[<span class="number">8</span> + width * (k + <span class="number">1</span>)] = <span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="comment">// high byte</span></span><br><span class="line">    <span class="keyword">for</span> (k = <span class="number">0</span>; k &lt; <span class="number">7</span>; k++ , y &gt;&gt;= <span class="number">1</span>)</span><br><span class="line">      <span class="keyword">if</span> (y &amp; <span class="number">1</span>) &#123;</span><br><span class="line">        qrframe[<span class="number">8</span> + width * (width - <span class="number">7</span> + k)] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (k)</span><br><span class="line">          qrframe[(<span class="number">6</span> - k) + width * <span class="number">8</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">          qrframe[<span class="number">7</span> + width * <span class="number">8</span>] = <span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="keyword">return</span> qrframe;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> _canvas = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> api = &#123;</span><br><span class="line"></span><br><span class="line">    get ecclevel() &#123;</span><br><span class="line">      <span class="keyword">return</span> ecclevel;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    set ecclevel(val) &#123;</span><br><span class="line">      ecclevel = val;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    get size() &#123;</span><br><span class="line">      <span class="keyword">return</span> _size;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    set size(val) &#123;</span><br><span class="line">      _size = val</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    get canvas() &#123;</span><br><span class="line">      <span class="keyword">return</span> _canvas;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    set canvas(el) &#123;</span><br><span class="line">      _canvas = el;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    getFrame: <span class="function"><span class="keyword">function</span> (<span class="params">string</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> genframe(string);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//这里的utf16to8(str)是对Text中的字符串进行转码，让其支持中文</span></span><br><span class="line">    utf16to8: <span class="function"><span class="keyword">function</span> (<span class="params">str</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> out, i, len, c;</span><br><span class="line"></span><br><span class="line">      out = <span class="string">""</span>;</span><br><span class="line">      len = str.length;</span><br><span class="line">      <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">        c = str.charCodeAt(i);</span><br><span class="line">        <span class="keyword">if</span> ((c &gt;= <span class="number">0x0001</span>) &amp;&amp; (c &lt;= <span class="number">0x007F</span>)) &#123;</span><br><span class="line">          out += str.charAt(i);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (c &gt; <span class="number">0x07FF</span>) &#123;</span><br><span class="line">          out += <span class="built_in">String</span>.fromCharCode(<span class="number">0xE0</span> | ((c &gt;&gt; <span class="number">12</span>) &amp; <span class="number">0x0F</span>));</span><br><span class="line">          out += <span class="built_in">String</span>.fromCharCode(<span class="number">0x80</span> | ((c &gt;&gt; <span class="number">6</span>) &amp; <span class="number">0x3F</span>));</span><br><span class="line">          out += <span class="built_in">String</span>.fromCharCode(<span class="number">0x80</span> | ((c &gt;&gt; <span class="number">0</span>) &amp; <span class="number">0x3F</span>));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          out += <span class="built_in">String</span>.fromCharCode(<span class="number">0xC0</span> | ((c &gt;&gt; <span class="number">6</span>) &amp; <span class="number">0x1F</span>));</span><br><span class="line">          out += <span class="built_in">String</span>.fromCharCode(<span class="number">0x80</span> | ((c &gt;&gt; <span class="number">0</span>) &amp; <span class="number">0x3F</span>));</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> out;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 新增$this参数，传入组件的this,兼容在组件中生成</span></span><br><span class="line"><span class="comment">     */</span> </span><br><span class="line">    draw: <span class="function"><span class="keyword">function</span> (<span class="params">str, canvas, cavW, cavH, $this, ecc</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> that = <span class="keyword">this</span>;</span><br><span class="line">      ecclevel = ecc || ecclevel;</span><br><span class="line">      canvas = canvas || _canvas;</span><br><span class="line">      <span class="keyword">if</span> (!canvas) &#123;</span><br><span class="line">        <span class="built_in">console</span>.warn(<span class="string">'No canvas provided to draw QR code in!'</span>)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> size = <span class="built_in">Math</span>.min(cavW, cavH);</span><br><span class="line">      str = that.utf16to8(str);<span class="comment">//增加中文显示</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> frame = that.getFrame(str),</span><br><span class="line">        <span class="comment">// 组件中生成qrcode需要绑定this </span></span><br><span class="line">        ctx = wx.createCanvasContext(canvas,$<span class="keyword">this</span>),</span><br><span class="line">        px = <span class="built_in">Math</span>.round(size / (width + <span class="number">8</span>));</span><br><span class="line">      <span class="keyword">var</span> roundedSize = px * (width + <span class="number">8</span>),</span><br><span class="line">        offset = <span class="built_in">Math</span>.floor((size - roundedSize) / <span class="number">2</span>);</span><br><span class="line">      size = roundedSize;</span><br><span class="line">      <span class="comment">//ctx.clearRect(0, 0, cavW, cavW);</span></span><br><span class="line">      ctx.setFillStyle(<span class="string">'#ffffff'</span>)</span><br><span class="line">      ctx.fillRect(<span class="number">0</span>, <span class="number">0</span>, cavW, cavW);</span><br><span class="line">      ctx.setFillStyle(<span class="string">'#000000'</span>);</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; width; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; width; j++) &#123;</span><br><span class="line">          <span class="keyword">if</span> (frame[j * width + i]) &#123;</span><br><span class="line">            ctx.fillRect(px * (<span class="number">4</span> + i) + offset, px * (<span class="number">4</span> + j) + offset, px, px);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      ctx.draw();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">module</span>.exports = &#123; api &#125;</span><br><span class="line">  <span class="comment">// exports.draw = api;</span></span><br><span class="line"></span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
      
    </div>

    

    
    
    


<div>
  
    ﻿<div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div>
    <!-- 文章结束广告 -->
        <!-- 文章结束广告 -->
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-9037517277428547"
             data-ad-slot="3344792375"
             data-ad-format="auto"
             data-full-width-responsive="true"></ins>
        <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
    
</div>

  
</div>

    

    
      
    
    

    

    <footer class="post-footer">
      
<div>
      
        ﻿<div class="my_post_copyright">
  <script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>
  
  <!-- JS库 sweetalert 可修改路径 -->
  <script src="https://cdn.bootcss.com/jquery/2.0.0/jquery.min.js"></script>
  <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
  <p><span>文章标题:</span><a href="/微信小程序-生成二维码.html">微信小程序-生成二维码</a></p>
  <p><span>文章作者:</span><a href="/" title="访问 YXZ 的个人博客">YXZ</a></p>
  <p><span>发布时间:</span>2018年06月06日 - 08:08</p>
  <p><span>更新时间:</span>2019年01月18日 - 15:50</p>
  <p><span>原始链接:</span><a href="/微信小程序-生成二维码.html" title="微信小程序-生成二维码">http://www.yangxiaozong.com/微信小程序-生成二维码.html</a>
    <span class="copy-path"  title="点击复制文章链接"><i class="fa fa-clipboard" data-clipboard-text="http://www.yangxiaozong.com/微信小程序-生成二维码.html"  aria-label="复制成功！"></i></span>
  </p>
  <p><span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">署名-非商业性使用-禁止演绎 4.0 国际</a> 转载请保留原文链接及作者。</p>  
</div>
<script> 
    var clipboard = new Clipboard('.fa-clipboard');
    $(".fa-clipboard").click(function(){
      clipboard.on('success', function(){
        swal({   
          title: "",   
          text: '复制成功',
          icon: "success", 
          showConfirmButton: true
          });
	});
    });  
</script>
      
</div>

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/自制google插件.html" rel="next" title="自制google插件">
                <i class="fa fa-chevron-left"></i> 自制google插件
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/mybatis中resultMap使用之返回分组数据.html" rel="prev" title="mybatis中resultMap使用之返回分组数据">
                mybatis中resultMap使用之返回分组数据 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      


        <div class="post-tags">
          
            <a href="/tags/小程序/" rel="tag"><i class="fa fa-tag"></i> 小程序</a>
          
        </div>
      
    </footer>
  </div>
  
  
  


  </article>


  </div>


          </div>
          



  
    <div class="comments" id="comments">
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/head.jpg"
                alt="YXZ"/>
            
              <p class="site-author-name" itemprop="name">YXZ</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives">
                
                    <span class="site-state-item-count">108</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">13</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">41</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/yxz112660" title="GitHub &rarr; https://github.com/yxz112660" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://weibo.com/5349350067/profile?rightmod=1&wvr=6&mod=personinfo&is_all=1" title="微博 &rarr; https://weibo.com/5349350067/profile?rightmod=1&wvr=6&mod=personinfo&is_all=1" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i>微博</a>
                </span>
              
            </div>
          

          

          
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#页面-wxml"><span class="nav-number">1.</span> <span class="nav-text">页面.wxml</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#样式-wxss"><span class="nav-number">2.</span> <span class="nav-text">样式.wxss</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#逻辑-js"><span class="nav-number">2.1.</span> <span class="nav-text">逻辑.js</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#需要的插件-qrcode-js"><span class="nav-number">3.</span> <span class="nav-text">需要的插件-qrcode.js</span></a></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

               <h3 style="border-top: 1px dotted #ccc;border-bottom: 1px dotted #ccc;text-align: center;">Advertising Position</h3>

              <!-- 边栏广告 -->
              <ins class="adsbygoogle"
                   style="display:inline-block;width:200px;"
                   data-ad-client="ca-pub-9037517277428547"
                   data-ad-slot="4988336092"
                   data-ad-format="auto"
                   data-full-width-responsive="true"></ins>
              <script>
              (adsbygoogle = window.adsbygoogle || []).push({});
              </script>
    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">  <a href="http://www.miitbeian.gov.cn" rel="noopener" target="_blank">苏ICP备18068125号-1 </a>&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">YXZ的个人博客</span>

  

  
</div>









        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="post-meta-item-icon">
      <i class="fa fa-user"></i>
    </span>
    <span class="site-uv" title="总访客量">
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  

  
    <span class="post-meta-divider">|</span>
  

  
    <span class="post-meta-item-icon">
      <i class="fa fa-eye"></i>
    </span>
    <span class="site-pv" title="总访问量">
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>









        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/src/utils.js?v=6.7.0"></script>

  <script src="/js/src/motion.js?v=6.7.0"></script>



  
  


  <script src="/js/src/affix.js?v=6.7.0"></script>

  <script src="/js/src/schemes/pisces.js?v=6.7.0"></script>




  
  <script src="/js/src/scrollspy.js?v=6.7.0"></script>
<script src="/js/src/post-details.js?v=6.7.0"></script>



  


  <script src="/js/src/bootstrap.js?v=6.7.0"></script>



  
  




  

<script src="//cdn1.lncld.net/static/js/3.11.1/av-min.js"></script>



<script src="//unpkg.com/valine/dist/Valine.min.js"></script>

<script>
  var GUEST = ['nick', 'mail', 'link'];
  var guest = 'nick,mail,link';
  guest = guest.split(',').filter(function (item) {
    return GUEST.indexOf(item) > -1;
  });
  new Valine({
    el: '#comments',
    verify: false,
    notify: true,
    appId: 'zloLR75GQyn0qVSD378eaIlB-gzGzoHsz',
    appKey: 'F9z3KfIY3WJqvASSubgpQWiD',
    placeholder: '填写昵称更好的称呼您\n填写邮箱更快的联系您\n填写您的网址更快的认识您',
    avatar: 'mm',
    meta: guest,
    pageSize: '10' || 10,
    visitor: false
  });
</script>



  




  
  
  
  <link rel="stylesheet" href="/lib/algolia-instant-search/instantsearch.min.css"/>

  
  
  <script src="/lib/algolia-instant-search/instantsearch.min.js"></script>
  

  <script src="/js/src/algolia-search.js?v=6.7.0"></script>



  
  
  <script>
    
    function addCount(Counter) {
      var $visitors = $('.leancloud_visitors');
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();

      Counter('get', '/classes/Counter', { where: JSON.stringify({ url }) })
        .done(function({ results }) {
          if (results.length > 0) {
            var counter = results[0];
            
              var $element = $(document.getElementById(url));
              $element.find('.leancloud-visitors-count').text(counter.time + 1);
            
            Counter('put', '/classes/Counter/' + counter.objectId, JSON.stringify({ time: { '__op': 'Increment', 'amount': 1 } }))
            
              .fail(function ({ responseJSON }) {
                console.log(`Failed to save Visitor num, with error message: ${responseJSON.error}`);
              })
          } else {
            
              var $element = $(document.getElementById(url));
              $element.find('.leancloud-visitors-count').text('Counter not initialized! More info at console err msg.');
              console.error('ATTENTION! LeanCloud counter has security bug, see how to solve it here: https://github.com/theme-next/hexo-leancloud-counter-security. \n However, you can still use LeanCloud without security, by setting `security` option to `false`.');
            
          }
        })
        .fail(function ({ responseJSON }) {
          console.log(`LeanCloud Counter Error: ${responseJSON.code} ${responseJSON.error}`);
        });
    }
    

    $(function() {
      $.get('https://app-router.leancloud.cn/2/route?appId=' + 'zloLR75GQyn0qVSD378eaIlB-gzGzoHsz')
        .done(function({ api_server }) {
          var Counter = function(method, url, data) {
            return $.ajax({
              method: method,
              url: 'https://' + api_server + '/1.1' + url,
              headers: {
                'X-LC-Id': 'zloLR75GQyn0qVSD378eaIlB-gzGzoHsz',
                'X-LC-Key': 'F9z3KfIY3WJqvASSubgpQWiD',
                'Content-Type': 'application/json',
              },
              data: data
            });
          };
          
            addCount(Counter);
          
        });
    });
  </script>



  

  

  

  

  

  

  

  

  

  

  
  <style>
    .copy-btn {
      display: inline-block;
      padding: 6px 12px;
      font-size: 13px;
      font-weight: 700;
      line-height: 20px;
      color: #333;
      white-space: nowrap;
      vertical-align: middle;
      cursor: pointer;
      background-color: #eee;
      background-image: linear-gradient(#fcfcfc, #eee);
      border: 1px solid #d5d5d5;
      border-radius: 3px;
      user-select: none;
      outline: 0;
    }

    .highlight-wrap .copy-btn {
      transition: opacity .3s ease-in-out;
      opacity: 0;
      padding: 2px 6px;
      position: absolute;
      right: 4px;
      top: 8px;
    }

    .highlight-wrap:hover .copy-btn,
    .highlight-wrap .copy-btn:focus {
      opacity: 1
    }

    .highlight-wrap {
      position: relative;
    }
  </style>
  <script>
    $('.highlight').each(function (i, e) {
      var $wrap = $('<div>').addClass('highlight-wrap');
      $(e).after($wrap);
      $wrap.append($('<button>').addClass('copy-btn').append('复制').on('click', function (e) {
        var code = $(this).parent().find('.code').find('.line').map(function (i, e) {
          return $(e).text();
        }).toArray().join('\n');
        var ta = document.createElement('textarea');
        var range = document.createRange(); //For Chrome
        var sel = window.getSelection(); //For Chrome
        var yPosition = window.pageYOffset || document.documentElement.scrollTop;
        ta.style.top = yPosition + 'px'; //Prevent page scroll
        ta.style.position = 'absolute';
        ta.style.opacity = '0';
        ta.value = code;
        ta.textContent = code; //For FireFox
        ta.contentEditable = true;
        ta.readOnly = false;
        document.body.appendChild(ta);
        range.selectNode(ta);
        sel.removeAllRanges();
        sel.addRange(range);
        ta.setSelectionRange(0, code.length);
        var result = document.execCommand('copy');
        
          if (result) $(this).text('复制成功');
          else $(this).text('复制失败');
        
        ta.blur(); //For iOS
        $(this).blur();
      })).on('mouseleave', function (e) {
        var $b = $(this).find('.copy-btn');
        setTimeout(function () {
          $b.text('复制');
        }, 300);
      }).append(e);
    })
  </script>


  

</body>
</html>
